<!--
  ~ This file is part of emuStudio.
  ~
  ~ Copyright (C) 2006-2020  Peter Jakubčo
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <https://www.gnu.org/licenses/>.
  -->

<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <title>As Z80 &diams; emuStudio</title>
    <meta name="keywords"
          content="emulator-programming,emulation-platform,emulation-framework,altair8800,Z80,intel-8080,SSEM,RAM,RASP,random-access-machine,random-access-stored-program-machine">
    <meta name="description" content="Universal computer emulation platform and framework.">
    <meta name=”robots” content=”noindex,follow”>

    <meta property="og:title" content="As Z80">
    <meta property="og:image" content="../../../img/logo-2.svg">
    <meta property="og:description" content="Universal computer emulation platform and framework.">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="emuStudio &diams; Computer emulation platform/framework"
          href="../../../feed.xml">
    <link rel="alternate" type="application/atom+xml" title="emuStudio &diams; Computer emulation platform/framework"
          href="../../../atom.xml">

    <!-- Favicons -->
    <link rel="shortcut icon" type="image/x-icon" href="../../../favicon.ico?">
    <meta name="application-name" content="emuStudio &diams; Computer emulation platform/framework">
    <meta name="msapplication-TileColor" content="#ffffff">

    <!-- Fonts -->
    <link rel="stylesheet"
          href="//fonts.googleapis.com/css?family=Roboto+Condensed:300,300italic,400,400italic,700,700italic|Oswald:300,400,700">

    <!-- Styles -->
    <link rel="stylesheet" href="../../../css/style.css">


    <!-- Scripts -->

    <!--[if lt IE 9]>
        <script src="../../../js/html5shiv.min.js"></script>
        <script src="../../../js/respond.min.js"></script>
    [endif]-->

    <script src="../../../js/jquery-3.1.1.min.js"></script>
    <script src="../../../js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous">
    </script>


    <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>


    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3492956-5"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-3492956-5');

    </script>

</head>


<body>


<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><i><img alt="&diams;" style="margin: -5px;margin-right:2px;"
                                                     src="../../../img/logo-2.svg" width="30px"/></i>emuStudio</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <!--<form class="navbar-form navbar-left" role="search">-->
            <!--<div class="form-group">-->
            <!--<input type="text" class="form-control" placeholder="Search website">-->
            <!--</div>-->
            <!--<button type="submit" class="btn btn-default">Submit</button>-->
            <!--</form>-->
            <ul class="nav navbar-nav navbar-right">

                <li>
                    <a href="/">Home</a>
                </li>

                <li>
                    <a href="/download">Download</a>
                </li>

                <li>
                    <a href="/docs">Docs</a>
                </li>

                <li>
                    <a href="/devel">Developer</a>
                </li>

                <li>
                    <a href="/roadmap">Roadmap</a>
                </li>

                <li>
                    <a href="/about">About</a>
                </li>

            </ul>
        </div>
    </div>
</nav>


<div class="title-group">
    <h1 class="special" data-toc-skip>
      <span>
          
            As Z80
          
      </span>
    </h1>


</div>


<div class="container">
    <div class="sect1">
        <h2 id="AS-Z80">Assembler <code>as-z80</code></h2>
        <div class="sectionbody">
            <div class="paragraph">
                <p>The assembler syntax is inspired by <a href="#AS-8080"><code>as-8080</code> assembler</a>, and by
                    instruction set described
                    <a href="http://www.z80.info/zip/z80cpu_um.pdf">here</a>. The assembler supports the following
                    features:</p>
            </div>
            <div class="ulist">
                <ul>
                    <li>
                        <p>full instructions support</p>
                    </li>
                    <li>
                        <p>macro support (unlimited nesting)</p>
                    </li>
                    <li>
                        <p>include other files support</p>
                    </li>
                    <li>
                        <p>conditional assembly</p>
                    </li>
                    <li>
                        <p>data definition</p>
                    </li>
                    <li>
                        <p>relative addressing using labels</p>
                    </li>
                    <li>
                        <p>literals and expressions in various radixes (bin, dec, hex, oct)</p>
                    </li>
                    <li>
                        <p>output is in <a href="https://en.wikipedia.org/wiki/Intel_HEX">Intel HEX</a> format</p>
                    </li>
                </ul>
            </div>
            <div class="sect2">
                <h3 id="installation-and-run">Installation and run</h3>
                <div class="paragraph">
                    <p>The assembler is provided as part of emuStudio. It is not deployed as individual package. It can
                        be found
                        in <code>compilers/</code> directory with name <code>as-z80.jar</code>.</p>
                </div>
                <div class="paragraph">
                    <p>The assembler can be run from command line, with command:</p>
                </div>
                <div class="literalblock">
                    <div class="content">
                        <pre>java -jar as-z80.jar [--output output_file.hex] [source_file.asm]</pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>To query for more information, run it with command:</p>
                </div>
                <div class="literalblock">
                    <div class="content">
                        <pre>java -jar as-z80.jar --help</pre>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="lexical-symbols">Lexical symbols</h3>
                <div class="paragraph">
                    <p>The assembler does not differentiate between upper and lower case (it is case-insensitive). The
                        token/symbol types
                        are as follows:</p>
                </div>
                <table class="tableblock frame-topbot grid-all spread table table-striped table-condensed">
                    <colgroup>
                        <col style="width: 50%;">
                        <col style="width: 50%;">
                    </colgroup>
                    <thead>
                    <tr>
                        <th class="tableblock halign-left valign-top">Type</th>
                        <th class="tableblock halign-left valign-top">Description</th>
                    </tr>
                    </thead>
                    <tfoot>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Comments</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">semi-colon (<code>;</code>)
                            with text after it until the end of the line</p></td>
                    </tr>
                    </tfoot>
                    <tbody>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Keywords</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">instruction names;
                            preprocessor directives (<code>org</code>, <code>equ</code>, <code>var</code>,
                            <code>macro</code>, <code>endm</code>, <code>include</code>,
                            <code>if</code>, <code>endif</code>); data definitions (<code>db</code>, <code>dw</code>,
                            <code>ds</code>); CPU registers</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Identifiers</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>([a-zA-Z_\?@])[a-zA-Z_\?@0-9]*</code>
                            except keywords</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Labels</p></td>
                        <td class="tableblock halign-left valign-top"></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Constants</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">strings or integers</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Operators</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code>,
                            <code>-</code>, <code>*</code>, <code>/</code>, <code>=</code>, <code>%</code>,
                            <code>&amp;</code>, <code>|</code>, <code>!</code>, <code>~</code>, <code>&lt;&lt;</code>,
                            <code>&gt;&gt;</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, '&#8656;`
                        </p></td>
                    </tr>
                    </tbody>
                </table>
                <div class="sect3">
                    <h4 id="constants">Constants</h4>
                    <div class="paragraph">
                        <p>Numeric constants can be only integers, encoded with one of several number radixes. The
                            possible formats are written
                            using regexes:</p>
                    </div>
                    <div class="ulist">
                        <ul>
                            <li>
                                <p>binary numbers: <code>[0-1]+[bB]</code></p>
                            </li>
                            <li>
                                <p>decimal numbers: <code>[0-9]+[dD]?</code></p>
                            </li>
                            <li>
                                <p>octal numbers: <code>[0-7]+[oOqQ]</code></p>
                            </li>
                            <li>
                                <p>hexadecimal numbers: <code>[0-9][0-9a-fA-F]*[hH]</code></p>
                            </li>
                        </ul>
                    </div>
                    <div class="paragraph">
                        <p>Characters or strings must be enclosed in double-quotes, e,g,: <code>LD E, "*"</code></p>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="Z80-IDENTIFIERS">Identifiers</h4>
                    <div class="paragraph">
                        <p>Identifiers must fit to the following regex: <code>([a-zA-Z_\?@])[a-zA-Z_\?@0-9]*</code>. It
                            means, that it has to start with
                            a letter a-z (or A-Z) or the at-sign (<code>@</code>). Then, it can be followed by letters,
                            at-sign, or numbers.</p>
                    </div>
                    <div class="paragraph">
                        <p>However, they must not equal to any keyword.</p>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="instructions-syntax">Instructions syntax</h3>
                <div class="paragraph">
                    <p>The program is basically a sequence of instructions. The instructions are separated by a new
                        line. The instruction
                        have optional and mandatory parts, e.g.:</p>
                </div>
                <div class="literalblock">
                    <div class="content">
                        <pre>LABEL: CODE OPERANDS ; COMMENT</pre>
                    </div>
                </div>
                <table class="tableblock frame-all grid-all spread table table-striped table-condensed">
                    <colgroup>
                        <col style="width: 33.3333%;">
                        <col style="width: 33.3333%;">
                        <col style="width: 33.3334%;">
                    </colgroup>
                    <tbody>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LABEL</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Identifier of the memory
                            position, followed by a colon (<code>:</code>).
                            It can be used as forward or backward reference in instructions
                            which expect memory address (or 16 bit number).</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>CODE</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Mandatory</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Instruction name.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>OPERANDS</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">It depends</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">If applicable, a
                            comma-separated (<code>,</code>) operands of the instruction.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>COMMENT</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">semi-colonm (<code>;</code>)
                            followed by any text until the end of the line.</p></td>
                    </tr>
                    </tbody>
                </table>
                <div class="paragraph">
                    <p>Fields <code>CODE</code> and <code>OPERANDS</code> must be separated by at least one space. For
                        example:</p>
                </div>
                <div class="literalblock">
                    <div class="content">
<pre>HERE:   LD C, 0  ; Put 0 into C register
        DB 3Ah   ; Data constant of size 1 byte
LOOP:   JP LOOP  ; Infinite loop</pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>Labels are optional. Instructions and pseudo-instructions and register names are reserved for
                        assembler and cannot
                        be used as labels. Also, there cannot be more definitions of the same label.</p>
                </div>
                <div class="paragraph">
                    <p>Operands must be separated with comma (<code>,</code>). There exist several operand types, which
                        represent so-called "address modes".
                        Allowed address modes depend on the instruction. The possibilities are:</p>
                </div>
                <div class="ulist">
                    <ul>
                        <li>
                            <p>Implicit addressing: instructions do not have operands. They are implicit.</p>
                        </li>
                        <li>
                            <p>Register addressing: operands are registers. 8-bit general-purpose register names are:
                                <code>A</code>, <code>B</code>, <code>C</code>, <code>D</code>, <code>E</code>,
                                <code>H</code>, <code>L</code>.
                                Register pairs have names: <code>BC</code>, <code>DE</code>, <code>HL</code>. Stack
                                pointer is defined as <code>SP</code>, and program status word (used by
                                <code>push</code>
                                / <code>pop</code> instructions) as <code>AF</code>. Another 16-bit registers are
                                defined as <code>IX</code>, <code>IY</code>.</p>
                        </li>
                        <li>
                            <p>Register indirect addressing: for example, loading a memory value at address in
                                <code>HL</code> pair: <code>LD A, (HL)</code>.</p>
                        </li>
                        <li>
                            <p>Immediate addressing: operand is the 8-bit constant. It can be also one character,
                                enclosed in double-quotes.</p>
                        </li>
                        <li>
                            <p>Direct addressing: operand is either 8-bit or 16-bit constant, which is understood as the
                                memory location (address).
                                For example: <code>LD (1234h), HL</code>.</p>
                        </li>
                    </ul>
                </div>
                <div class="paragraph">
                    <p>Immediate data or addresses can be defined in various ways:</p>
                </div>
                <div class="ulist">
                    <ul>
                        <li>
                            <p>Integer constant</p>
                        </li>
                        <li>
                            <p>Integer constant as a result of evaluation of some expression (e.g. <code>2 &lt;&lt;
                                4</code>, or <code>2 + 2</code>)</p>
                        </li>
                        <li>
                            <p>Current address - denoted by special variable <code>$</code>. For example, instruction
                                <code>JP $+6</code> denotes a jump by 6-bytes further
                                from the current address.</p>
                        </li>
                        <li>
                            <p>Character constants, enclosed in double-quotes (e.g. <code>LD A, "*"</code>)</p>
                        </li>
                        <li>
                            <p>Labels. For example: <code>JP THERE</code> will jump to the label <code>THERE</code>.</p>
                        </li>
                        <li>
                            <p>Variables. For example:</p>
                            <div class="literalblock">
                                <div class="content">
<pre>VALUE VAR 'A'
LD A, VALUE</pre>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="sect2">
                <h3 id="expressions">Expressions</h3>
                <div class="paragraph">
                    <p>An expression is a combination of the data constants and operators. Expressions are evaluated in
                        compile-time. Given
                        any two expressions, they must not be defined in circular way.</p>
                </div>
                <div class="paragraph">
                    <p>Expressions can be used anywhere a constant is expected.</p>
                </div>
                <div class="paragraph">
                    <p>There exist several operators, such as:</p>
                </div>
                <table class="tableblock frame-all grid-all spread table table-striped table-condensed">
                    <colgroup>
                        <col style="width: 50%;">
                        <col style="width: 50%;">
                    </colgroup>
                    <tbody>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Addition. Example: <code>DB
                            2 + 2</code>; evaluates to <code>DB 4</code></p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Subtraction. Example: <code>DW
                            $ - 2</code>; evaluates to the current compilation address minus 2.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Multiply.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Integer division.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>=</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Comparison for equality.
                            Returns 1 if operands equal, 0 otherwise. Example: <code>DB 2 = 2</code>; evaluates to
                            <code>DB 1</code>.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>%</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Remainder after integer
                            division. Example <code>DB 4 mod 3</code>; evaluates to <code>DB 1</code>.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Logical and.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>|</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Logical or.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>~</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Logical xor.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>!</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Logical not.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;&lt;</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Shift left by 1 bit.
                            Example: <code>DB 1 SHL 3</code>; evaluates to <code>DB 8</code></p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;&gt;</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Shift right by 1 bit.</p>
                        </td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Greater than. Example:
                            <code>DB 3 &gt; 2</code>; evaluates to <code>DB 1</code></p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Less than.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;=</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Greater or equal than.</p>
                        </td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>&#8656;</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Less or equal than.</p></td>
                    </tr>
                    </tbody>
                </table>
                <div class="paragraph">
                    <p>Operator priorities are as follows:</p>
                </div>
                <table class="tableblock frame-topbot grid-all spread table table-striped table-condensed">
                    <colgroup>
                        <col style="width: 33.3333%;">
                        <col style="width: 33.3333%;">
                        <col style="width: 33.3334%;">
                    </colgroup>
                    <thead>
                    <tr>
                        <th class="tableblock halign-left valign-top">Priority</th>
                        <th class="tableblock halign-left valign-top">Operator</th>
                        <th class="tableblock halign-left valign-top">Type</th>
                    </tr>
                    </thead>
                    <tfoot>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>|</code>,
                            <code>~</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Binary</p></td>
                    </tr>
                    </tfoot>
                    <tbody>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>( )</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Unary</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code>,
                            <code>/</code>, <code>%</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code>,
                            <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&#8656;</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Binary</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code>,
                            <code>-</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Unary and binary</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>=</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Binary</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>!</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Unary</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Binary</p></td>
                    </tr>
                    </tbody>
                </table>
                <div class="paragraph">
                    <p>All operators work with its arguments as if they were 16-bit. Their results are always 16-bit
                        numbers. If there
                        is expected 8-bit number, the result is automatically "cut" using operation <code>result AND
                            0FFh</code>. This may be unwanted
                        behavior and might lead to bugs, but it is often useful so the programmer must ensure the
                        correctness.</p>
                </div>
            </div>
            <div class="sect2">
                <h3 id="defining-data">Defining data</h3>
                <div class="paragraph">
                    <p>Data can be defined using special pseudoinstructions. These accept constants. Negative integers
                        are using
                        <a href="https://en.wikipedia.org/wiki/Two&#8217;s_complement">two&#8217;s complement</a>.</p>
                </div>
                <div class="paragraph">
                    <p>The following table describes all possible data definition pseudoinstructions:</p>
                </div>
                <table class="tableblock frame-all grid-all spread table table-striped table-condensed">
                    <colgroup>
                        <col style="width: 50%;">
                        <col style="width: 50%;">
                    </colgroup>
                    <tbody>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>DB [expression]</code>
                        </p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Define byte. The <code>[expression]</code>
                            must be of size 1 byte.
                            Using this pseudoinstruction, a string can be defined, enclosed in
                            single quotes. For example: <code>DB 'Hello, world!'</code> is equal to
                            <code>DB 'H'</code>, <code>DB 'e'</code>, etc. on separate lines.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>DW [expression]</code>
                        </p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Define word. The <code>[expression]</code>
                            must be max. of size 2 bytes.
                            Data are stored using <a href="https://en.wikipedia.org/wiki/Endianness#Little-endian">little
                                endian</a>.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>DS [expression]</code>
                        </p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Define storage. The <code>[expression]</code>
                            represents number of bytes which should
                            be "reserved". The reserved space will not be modified in memory.
                            It is similar to "skipping" particular number of bytes.</p></td>
                    </tr>
                    </tbody>
                </table>
                <div class="sect3">
                    <h4 id="examples">Examples:</h4>
                    <div class="literalblock">
                        <div class="content">
<pre>HERE:  DB 0A3H          ; A3
W0RD1: DB 5*2, 2FH-0AH  ; 0A25
W0RD2: DB 5ABCH SHR 8   ; 5A
STR:   DB "STRINGSpl"   ; 535452494E472031
MINUS: DB -03H          ; FD</pre>
                        </div>
                    </div>
                    <div class="literalblock">
                        <div class="content">
<pre>ADD1: dw COMP          ; 1C3B  (assume COMP is 3B1CH)
ADD2: dw FILL          ; B43E (assume FILL is 3EB4H)
ADD3: dw 3C01H, 3CAEH  ; 013CAE3C</pre>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="including-other-source-files">Including other source files</h3>
                <div class="paragraph">
                    <p>It is both useful and good practice to write modular programs. According to the
                        <a href="https://en.wikipedia.org/wiki/Don&#8217;t_repeat_yourself">DRY</a> principle the
                        repetitive parts of the program should be
                        refactored out into functions or modules. Functionally similar groups of these functions or
                        modules can be put into
                        a library, reusable in other programs.</p>
                </div>
                <div class="paragraph">
                    <p>The pseudoinstruction <code>include</code> exists for the purpose of including already written
                        source code into the current
                        program. The pseudoinstruction is defined as follows:</p>
                </div>
                <div class="literalblock">
                    <div class="content">
                        <pre>INCLUDE "[filename]"</pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>where <code>[filename]</code> is a relative or absolute path to the file which will be included,
                        enclosed in double-quotes.
                        The file can include other files, but there must not be defined circular includes (compiler will
                        complain).</p>
                </div>
                <div class="paragraph">
                    <p>The current compilation address (denoted by <code>$</code> variable) after the include will be
                        updated about the binary size
                        of the included file.</p>
                </div>
                <div class="paragraph">
                    <p>The namespace of the current program and the included file is <strong>shared</strong>. It means
                        that labels or variables with the
                        same name in the current program and the included file are prohibited. Include file "sees"
                        everything in the
                        current program as it was its part.</p>
                </div>
                <div class="paragraph">
                    <p>Example:</p>
                </div>
                <div class="paragraph">
                    <p>Let <code>a.asm</code> contains:</p>
                </div>
                <div class="literalblock">
                    <div class="content">
                        <pre>ld b, 80h</pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>Let <code>b.asm</code> contains:</p>
                </div>
                <div class="literalblock">
                    <div class="content">
                        <pre>include "a.asm"</pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>Then compiling <code>b.asm</code> will result in:</p>
                </div>
                <div class="literalblock">
                    <div class="content">
                        <pre>06 80     ; ld b, 80h</pre>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="origin-address-code-org-code">Origin address (<code>ORG</code>)</h3>
                <div class="paragraph">
                    <p>Syntax: <code>ORG [expression]</code></p>
                </div>
                <div class="paragraph">
                    <p>Sets the value to the <code>$</code> variable. It means that from now on, the following
                        instructions will be
                        placed at the address given by the <code>[expression]</code>. Effectively, it is the same as
                        using <code>DS</code> pseudo-instruction,
                        but instead of defining number of skipped bytes, we define concrete memory location (address).
                    </p>
                </div>
                <div class="paragraph">
                    <p>The following two code snippets are equal:</p>
                </div>
                <table class="tableblock frame-topbot grid-all spread table table-condensed">
                    <colgroup>
                        <col style="width: 25%;">
                        <col style="width: 25%;">
                        <col style="width: 25%;">
                        <col style="width: 25%;">
                    </colgroup>
                    <thead>
                    <tr>
                        <th class="tableblock halign-left valign-top">Address</th>
                        <th class="tableblock halign-left valign-top">Block 1</th>
                        <th class="tableblock halign-left valign-top">Block 2</th>
                        <th class="tableblock halign-left valign-top">Opcode</th>
                    </tr>
                    </thead>
                    <tfoot>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>2C10</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEXT: XOR A</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEXT: XOR A</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>AF</code></p></td>
                    </tr>
                    </tfoot>
                    <tbody>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>2C00</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LD A,C</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LD A,C</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>79</code></p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>2C01</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>JP NEXT</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>JP NEXT</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>C3 10 2C</code></p>
                        </td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>2C04</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>DS 12</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>ORG $+12</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="sect2">
                <h3 id="equate-code-equ-code">Equate (<code>EQU</code>)</h3>
                <div class="paragraph">
                    <p>Syntax: <code>[identifier] EQU [expression]</code></p>
                </div>
                <div class="paragraph">
                    <p>Define a constant. The <code>[identifier]</code> is a mandatory name of the constant. Please see
                        the <a href="#AS-8080-IDENTIFIERS">[AS-8080-IDENTIFIERS]</a>
                        section for more details.</p>
                </div>
                <div class="paragraph">
                    <p><code>[expression]</code> is the 16-bit expression.</p>
                </div>
                <div class="paragraph">
                    <p>The pseudo-instruction will define a constant - assign a name to given expression. The name of
                        the constant then can
                        be used anywhere where the constant is expected and the compiler will replace it with the
                        expression.</p>
                </div>
                <div class="paragraph">
                    <p>It is not possible to redefine a constant.</p>
                </div>
            </div>
            <div class="sect2">
                <h3 id="using-variables">Using variables</h3>
                <div class="paragraph">
                    <p>Syntax: <code>[identifier] VAR [expression]</code></p>
                </div>
                <div class="paragraph">
                    <p>Define or re-define a variable. The <code>[identifier]</code> is a mandatory name of the
                        constant. Please see
                        the <a href="#Z80-IDENTIFIERS">Identifiers</a> section for more details.</p>
                </div>
                <div class="paragraph">
                    <p><code>[expression]</code> is the 16-bit expression.</p>
                </div>
                <div class="paragraph">
                    <p>The pseudo-instruction will define a variable - assign a name to given expression. Then, the name
                        of the variable can
                        be used anywhere where the constant is expected.</p>
                </div>
                <div class="paragraph">
                    <p>It is possible to redefine a variable, which effectively means to reassign new expression to the
                        same name and forgetting
                        the old one. The reassignment is aware of locality, i.e. before it the old value will be used,
                        after it the new value
                        will be used.</p>
                </div>
            </div>
            <div class="sect2">
                <h3 id="conditional-assembly">Conditional assembly</h3>
                <div class="paragraph">
                    <p>Syntax:</p>
                </div>
                <div class="literalblock">
                    <div class="content">
<pre>if [expression]
    i n s t r u c t i o n s
endif</pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>At first, the compiler evaluates the <code>[expression]</code>. If the result is 0, instructions
                        between <code>if</code> and <code>endif</code> will be
                        ignored. Otherwise they will be included in the source code.</p>
                </div>
            </div>
            <div class="sect2">
                <h3 id="defining-and-using-macros">Defining and using macros</h3>
                <div class="paragraph">
                    <p>Syntax:</p>
                </div>
                <div class="literalblock">
                    <div class="content">
<pre>[identifier] macro [operands]
    i n s t r u c t i o n s
endm</pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>The <code>[identifier]</code> is a mandatory name of the macro. Please see the <a
                            href="#Z80-IDENTIFIERS">Identifiers</a> section for more details.</p>
                </div>
                <div class="paragraph">
                    <p>The <code>[operands]</code> part is a list of identifiers, separated by commas (<code>,</code>).
                        Inside the macro, operands act as constants.
                        If the macro does not use any operands, this part can be omitted.</p>
                </div>
                <div class="paragraph">
                    <p>The namespace of the operand identifiers is macro-local, ie. the operand names will not be
                        visible
                        outside the macro. Also, the operand names can hide variables, labels or constants defined in
                        the outer scope.</p>
                </div>
                <div class="paragraph">
                    <p>The macros can be understood as "templates" which will be expanded in the place where they are
                        "called". The
                        call syntax is as follows:</p>
                </div>
                <div class="literalblock">
                    <div class="content">
                        <pre>[macro name] [arguments]</pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>where <code>[macro name]</code> is the macro name as defined above. Then,
                        <code>[arguments]</code> are comma-separated expressions, in the
                        order as the original operands are defined. The number of arguments must be the same as number
                        of macro operands.</p>
                </div>
                <div class="paragraph">
                    <p>The macro can be defined anywhere in the program, even in some included file. Also, it does not
                        matter in which place
                        is called - above or below the macro definition.</p>
                </div>
                <div class="paragraph">
                    <p>Examples:</p>
                </div>
                <div class="literalblock">
                    <div class="content">
<pre>SHV MACRO
LOOP: RRCA        ; Right rotate with carry
      AND 7FH     ; Clear MSB of accumulator
      DEC D       ; Decrement rotation counter - register D
      JP NZ, LOOP ; Jump to next rotation
ENDM</pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>The macro <code>SHV</code> can be used as follows:</p>
                </div>
                <div class="literalblock">
                    <div class="content">
<pre>LD A, (TEMP)
LD D,3  ; 3 rotations
SHV
LD (TEMP), A</pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>Or another definition:</p>
                </div>
                <div class="literalblock">
                    <div class="content">
<pre>SHV MACRO AMT
      LD D,AMT   ; Number of rotations
LOOP: RRCA
      AND 7FH
      DEC D
      JP NZ, LOOP
ENDM</pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>And usage:</p>
                </div>
                <div class="literalblock">
                    <div class="content">
<pre>LD A, (TEMP)
SHV 5
LD (TEMP), A</pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>Which has the same effect as the previous example.</p>
                </div>
            </div>
        </div>
    </div>
</div>


<footer class="site-footer">
    <div class="container">
        <nav class="navbar">
            <div class="container">
                <ul class="nav navbar-nav">
                    <li><a href="https://github.com/vbmacher/emuStudio">GitHub</a></li>
                    <li><a href="https://sourceforge.net/p/net.emustudio/" rel="nofollow"><img alt="Download emuStudio"
                                                                                           src="https://sourceforge.net/sflogo.php?type=10&group_id=340604"></a>
                    </li>
                    <li class="navbar-text">&copy; Copyright 2006-2018, Peter Jakubčo</li>
                </ul>
            </div>
        </nav>
    </div>
</footer>

</body>
</html>

