<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Device 88-disk - User documentation for emuStudio</title> <link rel="shortcut icon" href="/documentation/user/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/documentation/user/assets/css/just-the-docs.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3492956-5"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', "UA-3492956-5"); </script> <script type="text/javascript" src="/documentation/user/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/documentation/user/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Device 88-disk | User documentation for emuStudio</title> <meta name="generator" content="Jekyll v3.8.5" /> <meta property="og:title" content="Device 88-disk" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="User documentation for emuStudio 0.40. emuStudio is universal emulation platform and framework targeting mainly academic sphere." /> <meta property="og:description" content="User documentation for emuStudio 0.40. emuStudio is universal emulation platform and framework targeting mainly academic sphere." /> <link rel="canonical" href="/documentation/user/altair8800/88-disk" /> <meta property="og:url" content="/documentation/user/altair8800/88-disk" /> <meta property="og:site_name" content="User documentation for emuStudio" /> <script type="application/ld+json"> {"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/documentation/user/assets/logo-1.svg"}},"description":"User documentation for emuStudio 0.40. emuStudio is universal emulation platform and framework targeting mainly academic sphere.","@type":"WebPage","url":"/documentation/user/altair8800/88-disk","headline":"Device 88-disk","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"> <title>Link</title> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="/documentation/user" class="site-title lh-tight"> <div class="site-logo"></div> </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item active"><a href="/documentation/user/404.html" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="/documentation/user/" class="navigation-list-link"></a></li><li class="navigation-list-item"><a href="/documentation/user/introduction/" class="navigation-list-link">Introduction</a></li><li class="navigation-list-item"><a href="/documentation/user/application/" class="navigation-list-link">emuStudio Application</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/documentation/user/application/automation" class="navigation-list-link">Automation</a></li><li class="navigation-list-item "><a href="/documentation/user/application/logging" class="navigation-list-link">Logging</a></li><li class="navigation-list-item "><a href="/documentation/user/application/opening-computer" class="navigation-list-link">Opening a computer</a></li><li class="navigation-list-item "><a href="/documentation/user/application/computer-schema" class="navigation-list-link">Computer schema</a></li><li class="navigation-list-item "><a href="/documentation/user/application/main-window" class="navigation-list-link">Main window</a></li></ul></li><li class="navigation-list-item active"><a href="/documentation/user/altair8800/" class="navigation-list-link">MITS Altair8800</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/documentation/user/altair8800/as-8080" class="navigation-list-link">Assembler as-8080</a></li><li class="navigation-list-item "><a href="/documentation/user/altair8800/as-z80" class="navigation-list-link">Assembler as-z80</a></li><li class="navigation-list-item "><a href="/documentation/user/altair8800/8080-cpu" class="navigation-list-link">CPU 8080-cpu</a></li><li class="navigation-list-item "><a href="/documentation/user/altair8800/z80-cpu" class="navigation-list-link">CPU z80-cpu</a></li><li class="navigation-list-item "><a href="/documentation/user/altair8800/standard-mem" class="navigation-list-link">Memory standard-mem</a></li><li class="navigation-list-item active"><a href="/documentation/user/altair8800/88-disk" class="navigation-list-link active">Device 88-disk</a></li><li class="navigation-list-item "><a href="/documentation/user/altair8800/88-sio" class="navigation-list-link">Device 88-sio</a></li><li class="navigation-list-item "><a href="/documentation/user/altair8800/adm3a-terminal" class="navigation-list-link">Device adm3a-terminal</a></li><li class="navigation-list-item "><a href="/documentation/user/altair8800/simhPseudo-z80" class="navigation-list-link">Device simhPseudo-z80</a></li><li class="navigation-list-item "><a href="/documentation/user/altair8800/software" class="navigation-list-link">Original software</a></li></ul></li></ul> </nav> </div> <footer class="site-footer"> <p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p> </footer> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search User documentation for emuStudio" aria-label="Search User documentation for emuStudio" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> <ul class="list-style-none text-small aux-nav"> <li class="d-inline-block my-0"><a href="/">Back to website</a></li> </ul> </div> <div class="page"> <nav class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/documentation/user/altair8800/">MITS Altair8800</a></li> <li class="breadcrumb-nav-list-item"><span>Device 88-disk</span></li> </ol> </nav> <div id="main-content" class="page-content" role="main"> <p>:imagepath: altair8800/images/</p> <p>[[DISK-88]] == Disk controller “88-disk”</p> <p>Altair Disk offered the advantage of fixed memory including relatively fast access to data. Data were transferred with speed 250 Kb/s (The plug-in does not emulate this). Disk was connected with disk controller (or board), and the data were transferred in serial fashion, bit after bit.</p> <p>Disk controller, on the other hand communicated with CPU. It transformed these serial data into 8-bit words which were stored/read by CPU into/from operating memory.</p> <p>MITS 88-DISK offered to connect up to 16 disk devices (one can be seen in the front image in the Introduction section).</p> <p>NOTE: Original manual can be downloaded at http://www.virtualaltair.com/virtualaltair.com/PDF/88dsk%20manual%20v2.pdf[this link].</p> <p>=== Features</p> <p>The plug-in emulates basic functionality of the whole disk system for Altair 8800 computer. It is not only disk controller, but also the disk drive.</p> <p>The features include:</p> <ul> <li>allows to mount up to 16 disk images</li> <li>CPU ports can be set manually</li> <li>interrupts are not implemented</li> <li>images can be saved for automatic mount at startup</li> <li>GUI</li> </ul> <p>[[DISK-88_MOUNTING_IMAGES]] === Mounting disk images</p> <p>In order to mount DISK images to the device, please go to the Settings window footnoteref:[peripheral,”peripheral devices” window in the Emulator panel in emuStudio]:</p> <p>image::{imagepath}/88-disk-01.png[Settings window of 88-DISK]</p> <ul> <li><em>A</em>: Select drive (A - P)</li> <li><em>B</em>: Choosing the image file</li> <li><em>C</em>: Set sectors count and sector length for the current drive footnote:[Be cautious with the settings. Incorrect values can result in disk image file damage. Default values are used for classic Altair8800 image files used by simh].</li> <li> <p><em>D</em>: Set default values for sector count and sector length for the current drive.</p> </li> <li><em>E</em>: Mount/unmount the image file onto/from the selected drive. Mount operation: If there is any disk mounted already, the new image will be re-mounted.</li> <li><em>F</em>: Check box for saving the settings into the computer configuration file. If checked, the settings will be loaded after start.</li> </ul> <p>=== CPU Ports settings</p> <p>MITS 88-DISK board communicates with CPU using its ports. There are three ports overall, each for different function. For more information, see section «DISK-88_PROGRAMMING». By default, the ports used by 88-DISK are:</p> <ul> <li>port 1: 0x08</li> <li>port 2: 0x09</li> <li>port 3: 0x0A</li> </ul> <p>These numbers can be changed in the Settings window, tab “CPU Ports”:</p> <p>image::{imagepath}/88-disk-02.png[Setting CPU ports]</p> <p>=== Configuration file</p> <p>Configuration file of virtual computers contain also settings of all the used plug-ins, including devices. Please read the section “Accessing settings of plug-ins” in the user documentation of Main module to see how the settings can be accessed.</p> <p>The following table shows all the possible settings of MITS 88-DISK plug-in:</p> <p>.Settings of MITS 88-DISK [frame=”topbot”,options=”header,footer”,role=”table table-striped table-condensed”] |========================================================================================== |Name | Default value | Valid values | Description |<code class="language-plaintext highlighter-rouge">port1CPU</code> | 0x08 | &gt; 0 and &lt; 256 | Number of Port 1 |<code class="language-plaintext highlighter-rouge">port2CPU</code> | 0x09 | &gt; 0 and &lt; 256 | Number of Port 2 |<code class="language-plaintext highlighter-rouge">port3CPU</code> | 0x0A | &gt; 0 and &lt; 256 | Number of Port 3 |<code class="language-plaintext highlighter-rouge">sectorsPerTrack</code> | 32 | &gt; 0 | Count of sectors in a disk image |<code class="language-plaintext highlighter-rouge">sectorLength</code> | 137 | &gt; 0 | Size of one sector in bytes |<code class="language-plaintext highlighter-rouge">image0</code> | N/A | Path to existing file| File name to mount on disk A (0) | … | … | … | … |<code class="language-plaintext highlighter-rouge">image15</code> | N/A | Path to existing file| File name to mount on disk P (15) |==========================================================================================</p> <p>[[DISK-88_PROGRAMMING]] === Programming</p> <p>Data are written onto or read from disk in a serial fashion. The position in the floppy disk is uniquely set by the track number, sector number and the offset in the sector. It is rudimentary to know how many tracks are available, so as how many sectors per track and the sector size.</p> <p>In Altair8800, drive <code class="language-plaintext highlighter-rouge">Pertec FD400</code> used 8” diskettes. Each had 77 tracks. The track had 32 sectors with 137 bytes long. The capacity was therefore <code class="language-plaintext highlighter-rouge">77 * 32 * 137 = 337568 B = 330 kB</code>. Software used less capacity, because 9 bytes from each sector were used for the integrity checksum.</p> <p>==== Setting the position</p> <p>Track number and sector number can be set only incrementally, not directly. Setting the offset within the sector is more challenging.</p> <p>After track and sector were set, programmer must “poll” the status port which tells him when the disk position is set to the beginning of the sector. Then, programmer must read data until he gets to the position where he wanted.</p> <p>==== CPU Ports</p> <p>The controller communicates with CPU using three I/O ports at addresses (by default) 0x08, 0x09 and 0x0A. The following table shows the CPU ports and how they are used.</p> <p>.Summary of CPU ports usage [frame=”topbot”,options=”header,footer”,role=”table table-condensed”] |================================================================ |Port | Address | Input | Output |1 | 0x08 | Disk and controller status | Select disk |2 | 0x09 | Get number of sector | Disk settings |3 | 0x0A | Read data | Write data |================================================================</p> <p>Now, detailed description of the ports follow. Bits are ordered in a byte as follows:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>D7 D6 D5 D4 D3 D2 D1 D0
</code></pre></div></div> <p>where <code class="language-plaintext highlighter-rouge">D7</code> is the most significant bit, and <code class="language-plaintext highlighter-rouge">D0</code> the least significant bit.</p> <p>===== Port 1 (default address: 0x08)</p> <p><em>WRITE</em>:</p> <p>Selects and enables one of 16 disk devices. By selecting a drive, all further operations will be performed on that drive. If the disk has not mounted any disk image, all further operations will be ignored. The previously selected device will be disabled.</p> <ul> <li><code class="language-plaintext highlighter-rouge">D7</code> : if the value is 1, disable the drive. If the value is 0, select and enable the drive.</li> <li><code class="language-plaintext highlighter-rouge">D6 D5 D4</code> : unused bits</li> <li><code class="language-plaintext highlighter-rouge">D3 D2 D1 D0</code>: index of the drive to be selected. From 0-15.</li> </ul> <p><em>READ</em>:</p> <p>Read disk status of the selected drive.</p> <ul> <li><code class="language-plaintext highlighter-rouge">D7</code> : <em>New read data available</em>. Indicates if there is at least 1 byte available for reading from Port 3 (value=0). It will be reset after data are read (value=1). If the value is 1, data read from Port 3 will be invalid or no new data is available.</li> <li><code class="language-plaintext highlighter-rouge">D6</code> : <em>Track 0</em>. Indicates if the head is positioned at track 0 (value=0).</li> <li><code class="language-plaintext highlighter-rouge">D5</code> : <em>Interrupt Enabled</em>. Indicates if interrupts are used (value=0). The plug-in does not support interrupts, therefore the value will be always 1.</li> <li><code class="language-plaintext highlighter-rouge">D4 D3</code> : Unused bits; they are always 0.</li> <li><code class="language-plaintext highlighter-rouge">D2</code> : <em>Head Status</em>. Indicates the correctness of the head setting. If the value is 0, reading sector number from Port 2 will be valid.</li> <li><code class="language-plaintext highlighter-rouge">D1</code> : <em>Move head</em>. Indicates if the movement of the disk head is allowed. If the value is 1, all track number changes will be ignored.</li> <li><code class="language-plaintext highlighter-rouge">D0</code> : <em>Enter new write data</em>. Indicates if the device is ready for writing data. If the value is 1, all written data will be ignored.</li> </ul> <p>Initial values of the bits are: <code class="language-plaintext highlighter-rouge">11100111</code>.</p> <p>===== Port 2 (default address: 0x09)</p> <p><em>WRITE</em>:</p> <p>Control the disk head, and other settings if a disk drive is selected.</p> <ul> <li><code class="language-plaintext highlighter-rouge">D7</code> : <em>Write Enable</em>. Initializes write sequence (enables writing to the disk; value=1). The plug-in sets the sector number to 0 and also value 0 to bit <code class="language-plaintext highlighter-rouge">D0</code> of Port 1 (<em>Enter new write data</em>) footnote:[According to manual the write sequence holds only for short time, maximally until the end of sector is reached. The plug-in does not limit the sequence period, it is deactivated only when the end of the sector is reached. In addition each first byte and the last byte of a sector should have set its MSB (7th bit) to 1. It was called the “sync bit” for easier identification of start or end of a sector. However, the plug-in does not require it.].</li> <li><code class="language-plaintext highlighter-rouge">D6</code> : <em>Head Current Switch</em>. On real disks the bit should be set to 1 when a program is writting data to tracks from 43-76. The plug-in the bit is ignored.</li> <li><code class="language-plaintext highlighter-rouge">D5</code> : <em>Interrupt Disable</em>. Setting is ignored sicne plug-in does not support interrupts.</li> <li><code class="language-plaintext highlighter-rouge">D4</code> : <em>Interrupt Enable</em>. Setting is ignored sicne plug-in does not support interrupts.</li> <li><code class="language-plaintext highlighter-rouge">D3</code> : <em>Head unload</em>. Removes head from the disk surface. Reading sector number will now become invalid. In addition, value of bit <code class="language-plaintext highlighter-rouge">D7</code> from Port 1 (<em>New read data available</em>) become 1 (no new data).</li> <li><code class="language-plaintext highlighter-rouge">D2</code> : <em>Head load</em>. Sets the disk head onto disk surface. Reading sector number now becomes valid. If additionally the bit <code class="language-plaintext highlighter-rouge">D7</code> from Port 1 (<em>New data available</em>) is set, it is possible to read data from the disk.</li> <li><code class="language-plaintext highlighter-rouge">D1</code> : <em>Step Out</em>. Move the disk head back by 1 track (the track number is decremented). It is required to check bit <code class="language-plaintext highlighter-rouge">D1</code> of Port 1 (<em>Move head</em>) to have value 0.</li> <li><code class="language-plaintext highlighter-rouge">D0</code> : <em>Step In</em>. Move the disk head ahead by 1 track (the track number is incremented). It is required to check bit <code class="language-plaintext highlighter-rouge">D1</code> of Port 1 (<em>Move head</em>) to have value 0.</li> </ul> <p><em>READ</em>:</p> <p>Reads the number of the sector. The value can be read only if a disk drive is selected and the disk head is positioned at the disk surface (by setting the bit <code class="language-plaintext highlighter-rouge">D2</code>).</p> <ul> <li><code class="language-plaintext highlighter-rouge">D7 D6</code> : Unused bits; they are always 1.</li> <li><code class="language-plaintext highlighter-rouge">D5 D4 D3 D2 D1</code>: Number of the sector, counted from 0.</li> <li><code class="language-plaintext highlighter-rouge">D0</code> : <em>Sector True</em>. If the value is 0, the offset in sector is 0 footnote:[According to manual, the bit is set for maximum 30 microseconds. Programs could detect the bit set and quickly start writing data until the <em>Sector true</em> came back again. It could be made in time easily, because CPU was much faster than disk itself. Plug-in does not limit the period. The value is 0 practically all the time, until first byte is written.].</li> </ul> <p>===== Port 3 (default address: 0x0A)</p> <p><em>WRITE</em>:</p> <p>Write a byte to disk. In order to perform valid write, the <em>Write Enable</em> <code class="language-plaintext highlighter-rouge">D7</code> bit of Port 2 must be set to 1. Before data are written to disk, it is required to check bit <code class="language-plaintext highlighter-rouge">D0</code> from Port 1 (<em>Enter new write data</em>).</p> <p><em>READ</em>:</p> <p>Read a byte from disk. In order to perform valid read, the <em>Head load</em> <code class="language-plaintext highlighter-rouge">D2</code> bit of Port 2 must be set to 1. Only if bit <code class="language-plaintext highlighter-rouge">D7</code> from Port 1 (<em>New read data available</em>) is set to 0, the read data are valid.</p> <p>==== Program example</p> <p>In this section, an example is presented showing how to read/write data from/to the floppy disk. At first, it writes one byte (letter <code class="language-plaintext highlighter-rouge">A</code> with ASCII value 65) to track 1, sector 18 and offset 20. Then, it reads the byte to operating memory at address 0x200.</p> <p>The program uses 3 procedures (in assembler for Intel 8080) for setting the disk position (<code class="language-plaintext highlighter-rouge">ltrack</code> for loading the track number, <code class="language-plaintext highlighter-rouge">lsector</code> for loading the sector number, and <code class="language-plaintext highlighter-rouge">loffset</code> for loading the offset within the sector) and two more for data reading (<code class="language-plaintext highlighter-rouge">read</code>) and writing (<code class="language-plaintext highlighter-rouge">write</code>).</p> <h2 id="example-program-for-writingreading-using-mits-88-disk"> <a href="#example-program-for-writingreading-using-mits-88-disk" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> .Example program for writing/reading using MITS 88-DISK </h2> <p>disk0 equ 0 ; disk number track equ 1 ; track number sector equ 18 ; sector number offset equ 20 ; offset within the sector data equ ‘A’ ; data for writing</p> <p>dcx sp ; set stack register to 0xFFFF</p> <p>mvi a, disk0 ; select disk out 08h</p> <p>call ltrack ; set track number</p> <p>call we ; set ‘write enable’ sequence call lsector ; set sector number call loffset ; set sector offset call write ; write data</p> <p>call lsector ; set sector number (for clearing the offset) call loffset ; set sector offset call read ; read data</p> <p>lxi h, readdata ; load address for reading the data mov m, a ; move the data there</p> <p>hlt ; end</p> <p>ltrack0: ; the procedure will set track number to 0 in 08h ; read disk status ani 1000000b ; track 0 ? rz ; yes, return mvi a, 1000b ; head unload out 09h call movetrk ; wait until the disk head can be moved mvi a, 10b ; step out, decrement track number out 08h jmp ltrack0</p> <p>ltrack: ; procedure sets a track number call ltrack0 ; at first, set track number to 0 mvi b, track+1 ; b = track + 1 stepin: ; stepin: { dcr b ; b–; rz ; if (b == 0) return; call movetrk ; wait until the disk head can be moved mvi a, 1 ; step in, increment track number out 09h jmp stepin ; goto stepin; ; }</p> <p>movetrk: ; procedure waits until the disk head can be moved in 08h ; read disk status ani 10b ; can the disk head be moved? jnz movetrk ; nope, try again… ret ; yes, return</p> <p>lsector: ; procedure sets a sector number mvi a, 100b ; head load out 09h waits: in 09h ; read sector number ani 3Fh ; clear unused bits rrc cpi sector ; is the number what is requested? jnz waits ; nope, try again ret ; yes, return</p> <p>loffset: ; procedure sets a sector offset mvi b, offset+1 ; b = offset + 1 stepoff: ; stepoff: { dcr b ; b–; rz ; if (b == 0) return; call read ; read data; the offset is incremented jmp stepoff ; goto stepoff; ; }</p> <p>read: ; procedure reads data from the disk in 08h ; read disk status ani 100b ; check if the disk head is loaded on the disk surface rnz ; if not, return waitr: in 08h ; read disk status ani 10000000b ; New read data available ? jnz waitr ; nope, try again… in 0Ah ; yes, read data ret ; return</p> <p>we: ; procedure enables ‘write enable’ sequence mvi a, 10000000b ; write enable out 09h ret</p> <p>write: ; procedure writes data to the disk in 08h ; read disk status ani 100b ; check if the disk head is loaded on the disk surface rnz ; if not, return waitw: in 08h ; read disk status ani 1 ; enter new write data ? jnz waitw ; nope, try again… mvi a, data ; yes, write data out 0Ah ret</p> <p>org 200h readdata: db 0 —————————————————–</p> </div> </div> </div> </div> </body> </html>
