<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Plugin contexts - Emulator programming tutorial for emuStudio 0.40</title> <link rel="shortcut icon" href="/documentation/developer/0.40/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/documentation/developer/0.40/assets/css/just-the-docs.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3492956-5"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', "UA-3492956-5"); </script> <script type="text/javascript" src="/documentation/developer/0.40/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/documentation/developer/0.40/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Plugin contexts | Emulator programming tutorial for emuStudio 0.40</title> <meta name="generator" content="Jekyll v3.8.5" /> <meta property="og:title" content="Plugin contexts" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Emulator programming tutorial for emuStudio 0.40. emuStudio is universal emulation platform and framework targeting mainly academic sphere." /> <meta property="og:description" content="Emulator programming tutorial for emuStudio 0.40. emuStudio is universal emulation platform and framework targeting mainly academic sphere." /> <link rel="canonical" href="/documentation/developer/0.40/plugin_basics/context" /> <meta property="og:url" content="/documentation/developer/0.40/plugin_basics/context" /> <meta property="og:site_name" content="Emulator programming tutorial for emuStudio 0.40" /> <script type="application/ld+json"> {"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/documentation/developer/0.40/assets/logo-1.svg"}},"description":"Emulator programming tutorial for emuStudio 0.40. emuStudio is universal emulation platform and framework targeting mainly academic sphere.","@type":"WebPage","url":"/documentation/developer/0.40/plugin_basics/context","headline":"Plugin contexts","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"> <title>Link</title> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="/documentation/developer/0.40" class="site-title lh-tight"> <div class="site-logo"></div> </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item active"><a href="/documentation/developer/0.40/404.html" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="/documentation/developer/0.40/" class="navigation-list-link"></a></li><li class="navigation-list-item"><a href="/documentation/developer/0.40/introduction/" class="navigation-list-link">Introduction</a></li><li class="navigation-list-item"><a href="/documentation/developer/0.40/getting_started/" class="navigation-list-link">Getting started</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/documentation/developer/0.40/getting_started/contributing" class="navigation-list-link">How to contribute</a></li><li class="navigation-list-item "><a href="/documentation/developer/0.40/getting_started/gitflow" class="navigation-list-link">Git workflow</a></li><li class="navigation-list-item "><a href="/documentation/developer/0.40/getting_started/documenting" class="navigation-list-link">Documenting</a></li></ul></li><li class="navigation-list-item active"><a href="/documentation/developer/0.40/plugin_basics/" class="navigation-list-link">Plugin basics</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/documentation/developer/0.40/plugin_basics/loading" class="navigation-list-link">Loading and initialization</a></li><li class="navigation-list-item active"><a href="/documentation/developer/0.40/plugin_basics/context" class="navigation-list-link active">Plugin contexts</a></li></ul></li><li class="navigation-list-item"><a href="/documentation/developer/0.40/compiler/" class="navigation-list-link">Writing a compiler</a></li><li class="navigation-list-item"><a href="/documentation/developer/0.40/cpu/" class="navigation-list-link">Writing a CPU</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/documentation/developer/0.40/cpu/rootclass" class="navigation-list-link">Plugin Root</a></li><li class="navigation-list-item "><a href="/documentation/developer/0.40/cpu/runstate" class="navigation-list-link">Run states</a></li><li class="navigation-list-item "><a href="/documentation/developer/0.40/cpu/engine" class="navigation-list-link">Emulator engine</a></li><li class="navigation-list-item "><a href="/documentation/developer/0.40/cpu/disassembler" class="navigation-list-link">Disassembler</a></li></ul></li><li class="navigation-list-item"><a href="/documentation/developer/0.40/memory/" class="navigation-list-link">Writing a memory</a></li><li class="navigation-list-item"><a href="/documentation/developer/0.40/device/" class="navigation-list-link">Writing a device</a></li></ul> </nav> </div> <footer class="site-footer"> <p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p> </footer> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search Emulator programming tutorial for emuStudio 0.40" aria-label="Search Emulator programming tutorial for emuStudio 0.40" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> <ul class="list-style-none text-small aux-nav"> <li class="d-inline-block my-0"><a href="/">Back to website</a></li> </ul> </div> <div class="page"> <nav class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/documentation/developer/0.40/plugin_basics/">Plugin basics</a></li> <li class="breadcrumb-nav-list-item"><span>Plugin contexts</span></li> </ol> </nav> <div id="main-content" class="page-content" role="main"> <h1 id="plugin-contexts"> <a href="#plugin-contexts" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Plugin contexts </h1> <p>Plugin contexts are answer to the question “how plugins communicate?”. Plugin root classes are seen by emuStudio, but not by plugins. Instead, plugins can register their own custom objects (called “contexts”) in the <a href="/documentation/developer/0.40/emulib_javadoc/net/emustudio/emulib/runtime/ContextPool.html" target="_blank">ContextPool</a> object during plugin <a href="/documentation/developer/0.40/plugin_basics/loading.html#plugin-instantiation">instantiation</a> (in the constructor). <a href="/documentation/developer/0.40/emulib_javadoc/net/emustudio/emulib/runtime/ContextPool.html" target="_blank">ContextPool</a> is a shared container of all plugin contexts. Plugins can also obtain contexts of other plugins, during plugin <a href="/documentation/developer/0.40/plugin_basics/loading.html#plugin-initialization">initialization</a>. Then, plugin communicate by calling regular Java methods on the plugin context objects, obtained from context pool.</p> <p><a href="/documentation/developer/0.40/emulib_javadoc/net/emustudio/emulib/runtime/ContextPool.html" target="_blank">ContextPool</a> is not thread-safe, so all operations on it should be performed in the same thread which called method <a href="/documentation/developer/0.40/emulib_javadoc/net/emustudio/emulib/plugins/Plugin.html#initialize()" target="_blank">Plugin.initialize()</a>.</p> <p>Each plugin context must implement a <a href="/documentation/developer/0.40/emulib_javadoc/net/emustudio/emulib/plugins/Context.html" target="_blank">Context</a> interface (or it’s derivative). Interfaces which extend <a href="/documentation/developer/0.40/emulib_javadoc/net/emustudio/emulib/plugins/Context.html" target="_blank">Context</a> must be then annotated with <a href="/documentation/developer/0.40/emulib_javadoc/net/emustudio/emulib/plugins/annotations/PluginContext.html" target="_blank">PluginContext</a> annotation. There are prepared some standard context interfaces in the API (<a href="/documentation/developer/0.40/emulib_javadoc/net/emustudio/emulib/plugins/compiler/CompilerContext.html" target="_blank">CompilerContext</a>, <a href="/documentation/developer/0.40/emulib_javadoc/net/emustudio/emulib/plugins/memory/MemoryContext.html" target="_blank">MemoryContext</a>, <a href="/documentation/developer/0.40/emulib_javadoc/net/emustudio/emulib/plugins/cpu/CPUContext.html" target="_blank">CpuContext</a> and <a href="/documentation/developer/0.40/emulib_javadoc/net/emustudio/emulib/plugins/device/DeviceContext.html" target="_blank">DeviceContext</a>), and those can be used when implementing plugin context class - or they can be further extended to provide customized versions of contexts.</p> <p>Plugin context objects are registered in <a href="/documentation/developer/0.40/emulib_javadoc/net/emustudio/emulib/runtime/ContextPool.html" target="_blank">ContextPool</a> as key-value pair, where the key is an context interface which the context implements, and value is the context object. A plugin can register none, one or many contexts. Single context object can be registered multiple times, if the keys (context interfaces) are different.</p> <p>Sample custom context might be created like this:</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PluginContext</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SampleContext</span> <span class="kd">extends</span> <span class="nc">CpuContext</span> <span class="o">{</span>

   <span class="c1">// custom methods...</span>
<span class="o">}</span>
</code></pre></div></div> <p>And the context class might look as follows:</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleContextImpl</span> <span class="kd">implements</span> <span class="nc">SampleContext</span> <span class="o">{</span>

   <span class="c1">// implementation ...</span>
<span class="o">}</span>
</code></pre></div></div> <p>Registration of this context might look as follows:</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PluginRoot</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="no">PLUGIN_TYPE</span><span class="o">.</span><span class="na">CPU</span><span class="o">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s">"Sample CPU emulator"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SamplePlugin</span> <span class="kd">implements</span> <span class="no">CPU</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">SamplePlugin</span><span class="o">(</span><span class="kt">long</span> <span class="n">pluginID</span><span class="o">,</span> <span class="nc">ApplicationApi</span> <span class="n">emustudio</span><span class="o">,</span> <span class="nc">PluginSettings</span> <span class="n">settings</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ContextPool</span> <span class="n">contextPool</span> <span class="o">=</span> <span class="n">emustudio</span><span class="o">.</span><span class="na">getContextPool</span><span class="o">();</span>

        <span class="nc">SampleContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SampleContextImpl</span><span class="o">();</span>

        <span class="c1">// We will register the same context two times, but by different context interfaces</span>
        <span class="n">contextPool</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">pluginID</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="nc">CpuContext</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> 
        <span class="n">contextPool</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">pluginID</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="nc">SampleContext</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>If another plugin wants to obtain the context, it should do it in the <a href="/documentation/developer/0.40/emulib_javadoc/net/emustudio/emulib/plugins/Plugin.html#initialize()" target="_blank">Plugin.initialize()</a> method:</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PluginRoot</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="no">PLUGIN_TYPE</span><span class="o">.</span><span class="na">DEVICE</span><span class="o">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s">"Sample device"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleDevice</span> <span class="kd">implements</span> <span class="nc">Device</span> <span class="o">{</span>

    <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">PluginInitializationException</span> <span class="o">{</span>

        <span class="c1">// If obtaining the context is not vital, catch the exception</span>
        <span class="nc">SampleContext</span> <span class="n">cpuContext</span> <span class="o">=</span> <span class="n">contextPool</span><span class="o">.</span><span class="na">getCPUContext</span><span class="o">(</span><span class="n">pluginID</span><span class="o">,</span> <span class="nc">SampleContext</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="o">...</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div> <p>If the requested context could not be found, or the plugins were not connected, an exception is thrown. If it is vital for the plugin to obtain the context, it should let it pass to the caller, otherwise it should be catched.</p> </div> </div> </div> </div> </body> </html>
